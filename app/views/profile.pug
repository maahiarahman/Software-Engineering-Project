extends layout

block content
  .dashboard-container
    // 🧍‍♀️ Sidebar
    aside.sidebar
      .user-info
        img.profile-thumb(src="/user-default.png", alt="User Avatar")
        h3 #{user.first_name} #{user.last_name}
        p.email #{user.email}
        if user.badge === 'Gold'
          div.user-badge
            i.fa-solid.fa-medal.text-yellow-400
            span Gold Member
        else if user.badge === 'Silver'
          div.user-badge
            i.fa-solid.fa-trophy.text-gray-400
            span Silver Member
        else if user.badge === 'Bronze'
          div.user-badge
            i.fa-solid.fa-award.text-orange-400
            span Bronze Member
      nav
        ul
          li.active: a(href="#dashboard") Dashboard Overview
          if recipes && recipes.length
            li: a(href="#user-recipes") My Recipes (#{recipes.length})
          if reviews && reviews.length
            li: a(href="#user-reviews") My Reviews (#{reviews.length})
          if posts && posts.length
            li: a(href="#user-posts") My Posts (#{posts.length})
          if swaps && swaps.length
            li: a(href="#user-swaps") My Swaps (#{swaps.length})

    // 📄 Main Content
    main.content
      header.profile-header
        .profile-meta
          h2 #{user.first_name} #{user.last_name}
          p Age: #{user.age}
          p User ID: #{user.user_ID}
          if user.badge
            span.user-badge(class=user.badge.toLowerCase())
              i.fa-solid.fa-medal
              | #{user.badge.toUpperCase()} MEMBER
        if isAdmin
          .admin-actions
            if !user.isBanned
              form(action=`/user/${user.user_ID}/ban`, method="POST")
                button.ban-btn(type="submit") Ban User
            else
              p.text-red-600.font-bold This user is banned.
            form(action=`/user/${user.user_ID}/delete`, method="POST")
              button.delete-btn(type="submit") Delete User

      // 📊 Summary Metrics
      section#dashboard.metrics
        .card
          h3 Recipes Uploaded
          p #{(recipes || []).length}
        .card
          h3 Reviews Written
          p #{(reviews || []).length}
        .card
          h3 Posts Made
          p #{(posts || []).length}
        .card
          h3 Swap Requests
          p #{(swaps || []).length}

      // 🍽️ Recipes Section
      if recipes && recipes.length
        section#user-recipes
          h3 User Recipes
          each recipe in recipes
            .recipe-card
              if recipe.image_url
                img(src=recipe.image_url, alt=recipe.name, style="width: 100%; max-width: 250px; border-radius: 12px;")
              h4 #{recipe.name}
              p
                small Category: #{recipe.category_id}
              p= recipe.description.length > 100 ? recipe.description.substring(0, 100) + '...' : recipe.description

      // 💬 Reviews Section
      if reviews && reviews.length
        section#user-reviews
          h3 User Reviews
          each review in reviews
            p= review.comment

      // 📝 Posts Section
      if posts && posts.length
        section#user-posts
          h3 User Posts
          each post in posts
            p= post.content

      // 🔁 Swaps Section
      if swaps && swaps.length
        section#user-swaps
          h3 User Swaps
          each swap in swaps
            p Swap with Recipe ID #{swap.swapped_recipe_id}

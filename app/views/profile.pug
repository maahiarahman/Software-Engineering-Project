extends layout

block content
  main.container

    // üåø Profile Box
    .profile-box.bg-white.shadow-lg.rounded-2xl.p-6.max-w-2xl.mx-auto.mt-10.text-center
      img.profile-pic.mx-auto.mb-4(src="/img/user-default.png", alt="User Image")
      h2.text-2xl.font-bold.text-green-800 #{user.first_name} #{user.last_name}
      p.text-gray-700.text-sm.mt-1 #{user.email}
      p.text-gray-600.mt-2 Age: #{user.age}
      p.text-gray-600.mt-1 DOB: #{user.date_of_birth.toDateString()}
      if user.last_login
        p.text-gray-600.mt-1 Last login: #{user.last_login.toLocaleString()}
      p.text-gray-600.mt-1 User ID: #{user.user_ID}

      // üîê Admin Controls
      if isAdmin
        if !user.isBanned
          form(action=`/user/${user.user_ID}/ban`, method="POST")
            button.request-swap-btn.mt-4(type="submit" onclick="return confirm('Ban this user?')") Ban User
        else
          p.text-red-500.font-bold.mt-4 This user is banned.

        form(action=`/user/${user.user_ID}/delete`, method="POST")
          button.delete-btn.mt-2(type="submit" onclick="return confirm('Delete this user permanently?')") Delete User

    // üìä Account Stats Grid
    h2.text-center.text-green-800.text-2xl.font-bold.mt-12.mb-6 Account Status

    div(class="grid grid-cols-2 md:grid-cols-4 gap-6 justify-center text-center mx-auto max-w-5xl")
      div(class="bg-white shadow-md p-6 rounded-xl")
        p.text-sm.text-gray-500.font-medium Account Active
        p.text-2xl.font-bold.text-green-700 #{!user.isBanned ? 'Yes' : 'No'}

      div(class="bg-white shadow-md p-6 rounded-xl")
        p.text-sm.text-gray-500.font-medium Recipes Uploaded
        p.text-2xl.font-bold.text-green-700 #{(recipes || []).length}

      div(class="bg-white shadow-md p-6 rounded-xl")
        p.text-sm.text-gray-500.font-medium Reviews Written
        p.text-2xl.font-bold.text-green-700 #{(reviews || []).length}

      div(class="bg-white shadow-md p-6 rounded-xl")
        p.text-sm.text-gray-500.font-medium Posts Made
        p.text-2xl.font-bold.text-green-700 #{(posts || []).length}

    // üçΩ Recipes
    if recipes && recipes.length
      h3.text-center.text-green-800.text-xl.font-bold.mt-10.mb-4 User Recipes
      div(class="recipe-grid")
        each recipe in recipes
          div(class="recipe-card")
            h4= recipe.name
            p= recipe.description
            if isAdmin
              form(action=`/user/${user.user_ID}/recipes/${recipe.recipe_id}/delete`, method="POST")
                button(type="submit" class="delete-btn" onclick="return confirm('Delete this recipe?')") Delete Recipe
    else
      div(class="text-center text-gray-400 text-sm mt-6")
        i.fa.fa-utensils.mr-2
        | No recipes found.

    // üí¨ Reviews
    if reviews && reviews.length
      h3.text-center.text-green-800.text-xl.font-bold.mt-10.mb-4 Reviews by User
      div(class="review-section")
        each review in reviews
          div(class="review-card")
            div(class="review-content")
              h4.font-semibold.text-green-700 Rating: #{review.rating} ‚≠ê
              p= review.comment
              p.text-xs.text-gray-500 Posted on #{review.created_at}
              if isAdmin
                form(action=`/user/${user.user_ID}/review/${review.review_ID}/delete`, method="POST")
                  button(type="submit" class="delete-btn" onclick="return confirm('Delete this review?')") Delete Review
    else
      div(class="text-center text-gray-400 text-sm mt-6")
        i.fa.fa-comment-dots.mr-2
        | No reviews found.

    // üìù Posts
    if posts && posts.length
      h3.text-center.text-green-800.text-xl.font-bold.mt-10.mb-4 User Posts
      div(class="overflow-x-auto")
        table.w-full.text-sm.border
          thead
            tr.bg-green-200.text-left
              th.px-4.py-2 Post ID
              th.px-4.py-2 User ID
              th.px-4.py-2 Recipe ID
              th.px-4.py-2 Date Posted
          tbody
            each post in posts
              tr.border-b
                td.px-4.py-2= post.post_ID
                td.px-4.py-2= post.user_ID
                td.px-4.py-2= post.recipe_ID
                td.px-4.py-2= post.date_posted
    else
      div(class="text-center text-gray-400 text-sm mt-6")
        i.fa.fa-pen.mr-2
        | No posts found.

    // üîÅ Swap Requests
    if swaps && swaps.length
      h3.text-center.text-green-800.text-xl.font-bold.mt-10.mb-4 Incoming Swap Requests
      div(class="swap-section")
        each swap in swaps
          div(class="swap-card")
            p Recipe requested: #{swap.recipe_name}
            p.text-xs Sent by user ID: #{swap.requester_id}
            p.text-xs Date: #{swap.created_at}
            div(class="flex justify-center gap-4 mt-2")
              button(type="button" class="request-swap-btn") Accept
              button(type="button" class="delete-btn") Reject
    else
      div(class="text-center text-gray-400 text-sm mt-6")
        i.fa.fa-sync.mr-2
        | No incoming swap requests.

    // üîª Footer Info
    div(class="mt-12 text-center text-xs text-gray-400 border-t pt-4")
      p Nom Nom | Profile Summary | Updated #{new Date().toLocaleDateString()}
